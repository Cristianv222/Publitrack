{% extends 'custom_admin/base_admin.html' %}
{% load static %}

{% block title %}Gesti贸n de Clientes - PubliTrack{% endblock %}

{% block extra_css %}
<style>
    .stats-card {
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        background: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stats-card h3 {
        font-size: 2rem;
        margin: 0;
        color: #333;
    }
    .stats-card p {
        margin: 5px 0 0 0;
        color: #666;
        font-size: 0.9rem;
    }
    .badge-status {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
    }
    .badge-activo {
        background-color: #d4edda;
        color: #155724;
    }
    .badge-inactivo {
        background-color: #f8d7da;
        color: #721c24;
    }
    .badge-suspendido {
        background-color: #fff3cd;
        color: #856404;
    }
    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
        cursor: pointer;
    }
    .btn-action {
        padding: 5px 10px;
        font-size: 0.875rem;
    }
    
    /* Estilos para modales animados */
    .animated-modal {
        border-radius: 15px !important;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2) !important;
    }
    .animated-modal .swal2-title {
        font-size: 1.75rem;
        font-weight: 600;
    }
    .animated-modal .swal2-html-container {
        font-size: 1rem;
        line-height: 1.6;
    }
    .swal2-popup.animated-modal .btn {
        padding: 10px 24px;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    .swal2-popup.animated-modal .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    /* Estilos para informaci贸n profesional */
    .profesion-badge {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .cargo-badge {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .info-profesional {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-top: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">
                <i class="fas fa-users me-2"></i>Gesti贸n de Clientes
            </h2>
            <p class="text-muted mb-0">Administra la informaci贸n de tus clientes</p>
        </div>
        {% if user.es_admin or user.es_vendedor %}
        <button class="btn btn-primary" onclick="abrirModalCrear()">
            <i class="fas fa-plus me-2"></i>Nuevo Cliente
        </button>
        {% endif %}
    </div>

    <!-- Estad铆sticas -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="text-primary">{{ total_clientes }}</h3>
                <p>Total de Clientes</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="text-success">{{ clientes_activos }}</h3>
                <p>Clientes Activos</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="text-danger">{{ clientes_inactivos }}</h3>
                <p>Clientes Inactivos</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card">
                <h3 class="text-info">{{ clientes_con_profesion }}</h3>
                <p>Con Profesi贸n Registrada</p>
            </div>
        </div>
    </div>

    <!-- Filtros -->
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-4">
                    <input type="text" name="search" class="form-control" 
                           placeholder="Buscar por nombre, empresa, RUC, profesi贸n..." 
                           value="{{ search }}">
                </div>
                <div class="col-md-2">
                    <select name="status" class="form-select">
                        <option value="">Todos los estados</option>
                        <option value="activo" {% if status_filter == 'activo' %}selected{% endif %}>Activos</option>
                        <option value="inactivo" {% if status_filter == 'inactivo' %}selected{% endif %}>Inactivos</option>
                        <option value="suspendido" {% if status_filter == 'suspendido' %}selected{% endif %}>Suspendidos</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select name="tiene_profesion" class="form-select">
                        <option value="">Todos</option>
                        <option value="si" {% if tiene_profesion_filter == 'si' %}selected{% endif %}>Con profesi贸n</option>
                        <option value="no" {% if tiene_profesion_filter == 'no' %}selected{% endif %}>Sin profesi贸n</option>
                    </select>
                </div>
                {% if user.es_admin %}
                <div class="col-md-2">
                    <select name="vendedor" class="form-select">
                        <option value="">Todos los vendedores</option>
                        {% for vendedor in vendedores %}
                        <option value="{{ vendedor.id }}" {% if vendedor_filter == vendedor.id|stringformat:"s" %}selected{% endif %}>
                            {{ vendedor.get_full_name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search me-2"></i>Filtrar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tabla de Clientes -->
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Empresa</th>
                            <th>RUC/C茅dula</th>
                            <th>Contacto</th>
                            <th>Informaci贸n Profesional</th>
                            <th>Email</th>
                            <th>Tel茅fono</th>
                            <th>Ciudad</th>
                            <th>Vendedor</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cliente in clientes %}
                        <tr>
                            <td>
                                <strong>{{ cliente.empresa|default:"-" }}</strong>
                                {% if cliente.razon_social %}
                                <br><small class="text-muted">{{ cliente.razon_social }}</small>
                                {% endif %}
                            </td>
                            <td>{{ cliente.ruc_dni|default:"-" }}</td>
                            <td>
                                {{ cliente.get_full_name|default:cliente.username }}
                                {% if cliente.cargo_empresa %}
                                <br><small class="text-muted">{{ cliente.cargo_empresa }}</small>
                                {% endif %}
                            </td>
                            <td>
                                {% if cliente.profesion %}
                                <span class="profesion-badge">{{ cliente.profesion }}</span>
                                {% else %}
                                <span class="text-muted">Sin profesi贸n</span>
                                {% endif %}
                            </td>
                            <td>{{ cliente.email }}</td>
                            <td>{{ cliente.telefono|default:"-" }}</td>
                            <td>{{ cliente.ciudad|default:"-" }}</td>
                            <td>
                                {% if cliente.vendedor_asignado %}
                                    <span class="badge bg-info">{{ cliente.vendedor_asignado.get_full_name }}</span>
                                {% else %}
                                    <span class="text-muted">Sin asignar</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if cliente.status == 'activo' %}
                                    <span class="badge-status badge-activo">Activo</span>
                                {% elif cliente.status == 'inactivo' %}
                                    <span class="badge-status badge-inactivo">Inactivo</span>
                                {% else %}
                                    <span class="badge-status badge-suspendido">Suspendido</span>
                                {% endif %}
                            </td>
                            <td>
                                <button class="btn btn-sm btn-info btn-action" 
                                        onclick="verDetalleCliente({{ cliente.id }})"
                                        title="Ver detalles">
                                    <i class="fas fa-eye"></i>
                                </button>
                                {% if user.es_admin or user.es_vendedor and cliente.vendedor_asignado == user %}
                                <button class="btn btn-sm btn-warning btn-action" 
                                        onclick="editarCliente({{ cliente.id }})"
                                        title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                {% endif %}
                                {% if user.es_admin %}
                                <button class="btn btn-sm btn-danger btn-action" 
                                        onclick="eliminarCliente({{ cliente.id }}, '{{ cliente.empresa|escapejs }}')"
                                        title="Eliminar">
                                    <i class="fas fa-trash"></i>
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="10" class="text-center py-4">
                                <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                <p class="text-muted">No se encontraron clientes</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<!-- Modal Crear/Editar Cliente -->
<div class="modal fade" id="modalCliente" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalClienteTitulo">Nuevo Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formCliente">
                    {% csrf_token %}
                    <input type="hidden" id="cliente_id" name="cliente_id">
                    
                    <!-- Informaci贸n B谩sica -->
                    <h6 class="mb-3 text-primary">Informaci贸n B谩sica</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Usuario <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="username" id="username" required>
                            <small class="text-muted">Identificador 煤nico del cliente</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">RUC/C茅dula <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="ruc_dni" id="ruc_dni" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Nombre de la Empresa <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="empresa" id="empresa" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Raz贸n Social</label>
                            <input type="text" class="form-control" name="razon_social" id="razon_social">
                        </div>
                    </div>

                    <!-- Informaci贸n Profesional -->
                    <h6 class="mb-3 text-primary">Informaci贸n Profesional</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Profesi贸n</label>
                            <input type="text" class="form-control" name="profesion" id="profesion" 
                                   placeholder="Ej: Ingeniero Civil, Licenciado en Administraci贸n, M茅dico...">
                            <small class="text-muted">Profesi贸n del contacto principal para contratos</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Cargo en la Empresa</label>
                            <input type="text" class="form-control" name="cargo_empresa" id="cargo_empresa" 
                                   placeholder="Ej: Gerente General, Propietario, Director...">
                            <small class="text-muted">Cargo que desempe帽a en la empresa</small>
                        </div>
                    </div>

                    <!-- Contacto -->
                    <h6 class="mb-3 text-primary">Informaci贸n de Contacto</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Nombre del Contacto</label>
                            <input type="text" class="form-control" name="first_name" id="first_name">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Apellido del Contacto</label>
                            <input type="text" class="form-control" name="last_name" id="last_name">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Correo Electr贸nico <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" name="email" id="email" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Tel茅fono <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="telefono" id="telefono" required>
                        </div>
                    </div>

                    <!-- Ubicaci贸n -->
                    <h6 class="mb-3 text-primary">Ubicaci贸n</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label">Ciudad <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="ciudad" id="ciudad" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Provincia/Estado <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="provincia" id="provincia" required>
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Direcci贸n Exacta</label>
                            <textarea class="form-control" name="direccion_exacta" id="direccion_exacta" rows="2"></textarea>
                        </div>
                    </div>

                    <!-- Informaci贸n Comercial -->
                    <h6 class="mb-3 text-primary">Informaci贸n Comercial</h6>
                    <div class="row g-3 mb-4">
                        <div class="col-md-12">
                            <label class="form-label">Giro Comercial</label>
                            <input type="text" class="form-control" name="giro_comercial" id="giro_comercial">
                        </div>
                        {% if user.es_admin %}
                        <div class="col-md-12">
                            <label class="form-label">Vendedor Asignado</label>
                            <select class="form-select" name="vendedor_asignado" id="vendedor_asignado">
                                <option value="">Sin asignar</option>
                                {% for vendedor in vendedores %}
                                <option value="{{ vendedor.id }}">{{ vendedor.get_full_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endif %}
                        <div class="col-md-6">
                            <label class="form-label">L铆mite de Cr茅dito</label>
                            <input type="number" class="form-control" name="limite_credito" id="limite_credito" step="0.01" value="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">D铆as de Cr茅dito</label>
                            <input type="number" class="form-control" name="dias_credito" id="dias_credito" value="0">
                        </div>
                        <div class="col-md-12">
                            <label class="form-label">Estado</label>
                            <select class="form-select" name="status" id="status">
                                <option value="activo">Activo</option>
                                <option value="inactivo">Inactivo</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="guardarCliente()">
                    <i class="fas fa-save me-2"></i>Guardar Cliente
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Ver Detalles -->
<div class="modal fade" id="modalDetalleCliente" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Detalles del Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="detalleClienteContent">
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
let modalCliente;
let modalDetalleCliente;

document.addEventListener('DOMContentLoaded', function() {
    modalCliente = new bootstrap.Modal(document.getElementById('modalCliente'));
    modalDetalleCliente = new bootstrap.Modal(document.getElementById('modalDetalleCliente'));
});

function abrirModalCrear() {
    document.getElementById('modalClienteTitulo').textContent = 'Nuevo Cliente';
    document.getElementById('formCliente').reset();
    document.getElementById('cliente_id').value = '';
    modalCliente.show();
}
function editarCliente(clienteId) {
    document.getElementById('modalClienteTitulo').textContent = 'Editar Cliente';
    document.getElementById('cliente_id').value = clienteId;
    
    // Cargar datos del cliente
    fetch(`/panel/clientes/${clienteId}/detalle/`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('username').value = data.username;
            document.getElementById('first_name').value = data.first_name || '';
            document.getElementById('last_name').value = data.last_name || '';
            document.getElementById('email').value = data.email;
            document.getElementById('telefono').value = data.telefono || '';
            document.getElementById('empresa').value = data.empresa || '';
            document.getElementById('ruc_dni').value = data.ruc_dni || '';
            document.getElementById('razon_social').value = data.razon_social || '';
            document.getElementById('giro_comercial').value = data.giro_comercial || '';
            document.getElementById('ciudad').value = data.ciudad || '';
            document.getElementById('provincia').value = data.provincia || '';
            document.getElementById('direccion_exacta').value = data.direccion_exacta || '';
            document.getElementById('limite_credito').value = data.limite_credito || '0';
            document.getElementById('dias_credito').value = data.dias_credito || '0';
            document.getElementById('status').value = data.status;
            
            // CORRECCIN: Cargar informaci贸n profesional correctamente
            document.getElementById('profesion').value = data.profesion || '';
            document.getElementById('cargo_empresa').value = data.cargo_empresa || '';
            
            if (document.getElementById('vendedor_asignado')) {
                document.getElementById('vendedor_asignado').value = data.vendedor_asignado_id || '';
            }
            
            console.log("Datos cargados para edici贸n:", {
                profesion: data.profesion,
                cargo_empresa: data.cargo_empresa
            });
            
            modalCliente.show();
        })
        .catch(error => {
            console.error('Error:', error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Error al cargar los datos del cliente',
                confirmButtonColor: '#3085d6'
            });
        });
}
function guardarCliente() {
    const clienteId = document.getElementById('cliente_id').value;
    const form = document.getElementById('formCliente');
    
    // DEBUG: Mostrar datos antes de enviar
    console.log("=== DEBUG FRONTEND ANTES DE ENVIAR ===");
    const formData = new FormData(form);
    for (let [key, value] of formData.entries()) {
        console.log(` ${key}: '${value}'`);
    }
    
    // Validaci贸n b谩sica antes de enviar
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    // Cerrar modal de cliente
    modalCliente.hide();
    
    // Mostrar loading
    Swal.fire({
        title: clienteId ? 'Actualizando...' : 'Guardando...',
        html: `
            <div class="text-center py-3">
                <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status">
                    <span class="visually-hidden">Guardando...</span>
                </div>
                <p class="text-muted mb-0">Por favor espere un momento</p>
            </div>
        `,
        allowOutsideClick: false,
        showConfirmButton: false,
        customClass: {
            popup: 'animated-modal'
        },
        showClass: {
            popup: 'animate__animated animate__fadeIn animate__faster'
        }
    });
    
    // Enviar el formulario normalmente
    form.action = clienteId 
        ? `/panel/clientes/${clienteId}/editar/`
        : '/panel/clientes/crear/';
    form.method = 'POST';
    form.submit();
}

function verDetalleCliente(clienteId) {
    // Mostrar loading
    const loadingHtml = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
        </div>
    `;
    document.getElementById('detalleClienteContent').innerHTML = loadingHtml;
    modalDetalleCliente.show();
    
    fetch(`/panel/clientes/${clienteId}/detalle/`)
        .then(response => response.json())
        .then(data => {
            // Construir HTML para informaci贸n profesional
            let infoProfesionalHtml = '';
            if (data.profesion) {
                infoProfesionalHtml = `
                    <div class="info-profesional">
                        <h6 class="mb-3">Informaci贸n Profesional</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <strong>Profesi贸n:</strong><br>
                                <span class="profesion-badge">${data.profesion}</span>
                            </div>
                            ${data.cargo_empresa ? `
                            <div class="col-md-6 mt-2">
                                <strong>Cargo:</strong><br>
                                <span class="cargo-badge">${data.cargo_empresa}</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            const html = `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <strong>Empresa:</strong><br>
                        ${data.empresa || '-'}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>RUC/C茅dula:</strong><br>
                        ${data.ruc_dni || '-'}
                    </div>
                    <div class="col-md-12 mb-3">
                        <strong>Raz贸n Social:</strong><br>
                        ${data.razon_social || '-'}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Contacto:</strong><br>
                        ${data.first_name} ${data.last_name}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Email:</strong><br>
                        ${data.email}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Tel茅fono:</strong><br>
                        ${data.telefono || '-'}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Giro Comercial:</strong><br>
                        ${data.giro_comercial || '-'}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Ciudad:</strong><br>
                        ${data.ciudad || '-'}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Provincia:</strong><br>
                        ${data.provincia || '-'}
                    </div>
                    <div class="col-md-12 mb-3">
                        <strong>Direcci贸n:</strong><br>
                        ${data.direccion_exacta || '-'}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Vendedor Asignado:</strong><br>
                        ${data.vendedor_asignado_nombre || 'Sin asignar'}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>Estado:</strong><br>
                        <span class="badge-status badge-${data.status}">${data.status}</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>L铆mite de Cr茅dito:</strong><br>
                        $${data.limite_credito}
                    </div>
                    <div class="col-md-6 mb-3">
                        <strong>D铆as de Cr茅dito:</strong><br>
                        ${data.dias_credito} d铆as
                    </div>
                    <div class="col-md-12 mb-3">
                        <strong>Fecha de Registro:</strong><br>
                        ${data.fecha_registro}
                    </div>
                </div>
                ${infoProfesionalHtml}
            `;
            document.getElementById('detalleClienteContent').innerHTML = html;
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('detalleClienteContent').innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    Error al cargar los detalles del cliente
                </div>
            `;
        });
}

// FUNCIN ELIMINAR
function eliminarCliente(clienteId, nombreEmpresa) {
    Swal.fire({
        title: '驴Eliminar cliente?',
        html: `
            <div class="text-center mb-3">
                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                <p class="mb-2">驴Est谩s seguro de eliminar el cliente:</p>
                <h5 class="text-primary mb-2">${nombreEmpresa}</h5>
                <small class="text-muted d-block">
                    <i class="fas fa-info-circle me-1"></i>
                    Si tiene cu帽as asociadas, solo se inactivar谩
                </small>
            </div>
        `,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: '<i class="fas fa-trash me-2"></i>S铆, eliminar',
        cancelButtonText: '<i class="fas fa-times me-2"></i>Cancelar',
        reverseButtons: true,
        customClass: {
            popup: 'animated-modal',
            confirmButton: 'btn btn-lg px-4',
            cancelButton: 'btn btn-lg px-4'
        },
        buttonsStyling: false,
        showClass: {
            popup: 'animate__animated animate__zoomIn animate__faster'
        },
        hideClass: {
            popup: 'animate__animated animate__zoomOut animate__faster'
        }
    }).then((result) => {
        if (result.isConfirmed) {
            // Mostrar loading
            Swal.fire({
                title: 'Eliminando...',
                html: `
                    <div class="text-center py-3">
                        <div class="spinner-border text-danger mb-3" style="width: 3rem; height: 3rem;" role="status">
                            <span class="visually-hidden">Eliminando...</span>
                        </div>
                        <p class="text-muted mb-0">Por favor espere un momento</p>
                    </div>
                `,
                allowOutsideClick: false,
                showConfirmButton: false,
                customClass: {
                    popup: 'animated-modal'
                },
                showClass: {
                    popup: 'animate__animated animate__fadeIn animate__faster'
                }
            });
            
            // Crear un formulario temporal para hacer el POST
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/panel/clientes/${clienteId}/eliminar/`;
            
            // Agregar CSRF token
            const csrfInput = document.createElement('input');
            csrfInput.type = 'hidden';
            csrfInput.name = 'csrfmiddlewaretoken';
            csrfInput.value = document.querySelector('[name=csrfmiddlewaretoken]').value;
            form.appendChild(csrfInput);
            
            // Agregar al body y enviar
            document.body.appendChild(form);
            form.submit();
        }
    });
}

// Funci贸n para probar el 煤ltimo cliente creado
function debugUltimoCliente() {
    fetch('/panel/debug/ultimo-cliente/')
        .then(response => response.json())
        .then(data => {
            console.log("=== DEBUG LTIMO CLIENTE ===");
            console.log("Datos del 煤ltimo cliente:", data);
            
            Swal.fire({
                title: 'ltimo Cliente Creado',
                html: `
                    <div class="text-left">
                        <p><strong>Empresa:</strong> ${data.empresa || '-'}</p>
                        <p><strong>Profesi贸n:</strong> ${data.profesion || '-'}</p>
                        <p><strong>Cargo:</strong> ${data.cargo_empresa || '-'}</p>
                        <p><strong>Tiene profesi贸n:</strong> ${data.profesion ? 'S铆' : 'No'}</p>
                        <p><strong>Tiene cargo:</strong> ${data.cargo_empresa ? 'S铆' : 'No'}</p>
                        <p><strong>Fecha creaci贸n:</strong> ${data.fecha_creacion}</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Cerrar'
            });
        })
        .catch(error => {
            console.error('Error en debug:', error);
        });
}
</script>
{% endblock %}