{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard Productor - PublicTrack{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #2563eb;
        --primary-dark: #1e40af;
        --secondary-color: #64748b;
        --success-color: #10b981;
        --warning-color: #f59e0b;
        --danger-color: #ef4444;
        --info-color: #06b6d4;
        --light-bg: #f8fafc;
        --border-color: #e2e8f0;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    body {
        background-color: var(--light-bg);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    /* Header */
    .page-header {
        background: white;
        border-bottom: 1px solid var(--border-color);
        padding: 1.5rem 0;
        margin-bottom: 2rem;
    }

    .page-title {
        font-size: 1.875rem;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
    }

    .page-subtitle {
        color: var(--secondary-color);
        font-size: 0.875rem;
        margin: 0.25rem 0 0 0;
    }

    /* Stat Cards */
    .stat-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        transition: all 0.2s ease;
        height: 100%;
    }

    .stat-card:hover {
        box-shadow: var(--shadow-lg);
        border-color: #cbd5e1;
    }

    .stat-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .stat-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .stat-icon.primary {
        background-color: #eff6ff;
        color: var(--primary-color);
    }

    .stat-icon.warning {
        background-color: #fffbeb;
        color: var(--warning-color);
    }

    .stat-icon.success {
        background-color: #f0fdf4;
        color: var(--success-color);
    }

    .stat-icon.info {
        background-color: #ecfeff;
        color: var(--info-color);
    }

    .stat-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--secondary-color);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #0f172a;
        line-height: 1;
        margin-bottom: 0.25rem;
    }

    .stat-description {
        font-size: 0.875rem;
        color: var(--secondary-color);
    }

    .stat-trend {
        display: inline-flex;
        align-items: center;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        margin-top: 0.5rem;
    }

    .stat-trend.up {
        background-color: #f0fdf4;
        color: var(--success-color);
    }

    .stat-trend.down {
        background-color: #fef2f2;
        color: var(--danger-color);
    }

    /* Main Card */
    .main-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        overflow: hidden;
    }

    .card-header-pro {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        background: white;
    }

    .card-title-pro {
        font-size: 1.125rem;
        font-weight: 600;
        color: #0f172a;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .card-body-pro {
        padding: 0;
    }

    /* Project Items */
    .project-item {
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .project-item:last-child {
        border-bottom: none;
    }

    .project-item:hover {
        background-color: #f8fafc;
    }

    .project-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
    }

    .project-title {
        font-size: 1rem;
        font-weight: 600;
        color: #0f172a;
        margin: 0 0 0.5rem 0;
    }

    .project-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        font-size: 0.875rem;
        color: var(--secondary-color);
    }

    .project-meta-item {
        display: flex;
        align-items: center;
        gap: 0.375rem;
    }

    .project-meta-item i {
        font-size: 0.75rem;
    }

    /* Status Badges */
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.75rem;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .status-badge.produccion {
        background-color: #eff6ff;
        color: var(--primary-color);
        border: 1px solid #bfdbfe;
    }

    .status-badge.pendiente {
        background-color: #fffbeb;
        color: #d97706;
        border: 1px solid #fde68a;
    }

    .status-badge.aprobada {
        background-color: #f0fdf4;
        color: var(--success-color);
        border: 1px solid #bbf7d0;
    }

    .status-badge.activa {
        background-color: #ecfeff;
        color: var(--info-color);
        border: 1px solid #a5f3fc;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 0.5rem;
    }

    .action-btn {
        width: 36px;
        height: 36px;
        padding: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: white;
        color: var(--secondary-color);
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .action-btn:hover {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        transform: translateY(-1px);
    }

    /* Filter Pills */
    .filter-pills {
        display: flex;
        gap: 0.5rem;
    }

    .filter-pill {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: white;
        color: var(--secondary-color);
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .filter-pill:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
    }

    .filter-pill.active {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    /* Quick Actions */
    .quick-action-btn {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.875rem 1rem;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        background: white;
        color: #0f172a;
        font-weight: 500;
        transition: all 0.2s ease;
        text-decoration: none;
    }

    .quick-action-btn:hover {
        background-color: var(--light-bg);
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateX(4px);
    }

    .quick-action-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.125rem;
        flex-shrink: 0;
    }

    .quick-action-icon.primary {
        background-color: #eff6ff;
        color: var(--primary-color);
    }

    .quick-action-icon.success {
        background-color: #f0fdf4;
        color: var(--success-color);
    }

    .quick-action-icon.info {
        background-color: #ecfeff;
        color: var(--info-color);
    }

    .quick-action-icon.secondary {
        background-color: #f1f5f9;
        color: var(--secondary-color);
    }

    /* Progress Bars */
    .progress-container {
        margin-top: 0.75rem;
    }

    .progress-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }

    .progress-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: #475569;
    }

    .progress-value {
        font-size: 0.875rem;
        font-weight: 600;
        color: #0f172a;
    }

    .progress-bar-custom {
        height: 8px;
        background-color: #f1f5f9;
        border-radius: 4px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: width 0.5s ease;
    }

    .progress-fill.primary {
        background-color: var(--primary-color);
    }

    .progress-fill.success {
        background-color: var(--success-color);
    }

    .progress-fill.warning {
        background-color: var(--warning-color);
    }

    .progress-fill.info {
        background-color: var(--info-color);
    }

    /* Empty State */
    .empty-state {
        padding: 4rem 2rem;
        text-align: center;
    }

    .empty-state-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        background-color: #f8fafc;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: var(--secondary-color);
    }

    .empty-state-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 0.5rem;
    }

    .empty-state-description {
        font-size: 0.875rem;
        color: var(--secondary-color);
    }

    /* Date Badge */
    .date-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background-color: white;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-size: 0.875rem;
        color: var(--secondary-color);
    }

    /* Notification Badge */
    .notification-badge {
        position: relative;
        display: inline-flex;
    }

    .notification-count {
        position: absolute;
        top: -8px;
        right: -8px;
        min-width: 20px;
        height: 20px;
        padding: 0 6px;
        background-color: var(--danger-color);
        color: white;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .page-header {
            padding: 1rem 0;
        }

        .page-title {
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 1.75rem;
        }

        .filter-pills {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">
    <!-- Page Header -->
    <div class="page-header">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="page-title">
                    <i class="fas fa-video me-2" style="color: var(--primary-color);"></i>
                    Dashboard de Producción
                </h1>
                <p class="page-subtitle">
                    Bienvenido, <strong>{{ user.get_full_name }}</strong> • {{ user.email }}
                </p>
            </div>
            <div class="col-md-6 text-md-end mt-3 mt-md-0">
                <div class="date-badge">
                    <i class="far fa-calendar-alt"></i>
                    <span>{{ hoy|date:"l, d F Y" }}</span>
                </div>
                <div class="date-badge ms-2">
                    <i class="far fa-clock"></i>
                    <span id="reloj-tiempo-real"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
        <!-- En Producción -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="card-body p-4">
                    <div class="stat-card-header">
                        <div class="flex-grow-1">
                            <p class="stat-label">En Producción</p>
                            <h2 class="stat-value">{{ cuñas_en_produccion }}</h2>
                            <p class="stat-description mb-0">Proyectos activos</p>
                        </div>
                        <div class="stat-icon primary">
                            <i class="fas fa-cogs"></i>
                        </div>
                    </div>
                    <div class="stat-trend up">
                        <i class="fas fa-arrow-up me-1"></i> Activo
                    </div>
                </div>
            </div>
        </div>

        <!-- Pendientes -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="card-body p-4">
                    <div class="stat-card-header">
                        <div class="flex-grow-1">
                            <p class="stat-label">Pendientes</p>
                            <h2 class="stat-value">{{ cuñas_pendientes }}</h2>
                            <p class="stat-description mb-0">Requieren atención</p>
                        </div>
                        <div class="stat-icon warning">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="stat-trend down">
                        <i class="fas fa-arrow-down me-1"></i> Urgente
                    </div>
                </div>
            </div>
        </div>

        <!-- Completados Hoy -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="card-body p-4">
                    <div class="stat-card-header">
                        <div class="flex-grow-1">
                            <p class="stat-label">Completados Hoy</p>
                            <h2 class="stat-value">{{ cuñas_completadas_hoy }}</h2>
                            <p class="stat-description mb-0">Finalizados</p>
                        </div>
                        <div class="stat-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="stat-trend up">
                        <i class="fas fa-arrow-up me-1"></i> +12%
                    </div>
                </div>
            </div>
        </div>

        <!-- Al Aire -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card">
                <div class="card-body p-4">
                    <div class="stat-card-header">
                        <div class="flex-grow-1">
                            <p class="stat-label">Al Aire</p>
                            <h2 class="stat-value">{{ cuñas_activas }}</h2>
                            <p class="stat-description mb-0">Transmitiendo</p>
                        </div>
                        <div class="stat-icon info">
                            <i class="fas fa-broadcast-tower"></i>
                        </div>
                    </div>
                    <div class="stat-trend up">
                        <i class="fas fa-signal me-1"></i> En vivo
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row g-4">
        <!-- Projects List -->
        <div class="col-lg-8">
            <div class="main-card">
                <div class="card-header-pro">
                    <div class="d-flex justify-content-between align-items-center">
                        <h3 class="card-title-pro">
                            <i class="fas fa-list-ul"></i>
                            Proyectos Recientes
                        </h3>
                        <div class="filter-pills">
                            <button class="filter-pill active" data-filter="todos">Todos</button>
                            <button class="filter-pill" data-filter="produccion">En producción</button>
                            <button class="filter-pill" data-filter="pendientes">Pendientes</button>
                        </div>
                    </div>
                </div>
                <div class="card-body-pro">
                    {% if ultimas_cuñas %}
                        {% for cuña in ultimas_cuñas %}
                        <div class="project-item">
                            <div class="project-header">
                                <div class="flex-grow-1">
                                    <h4 class="project-title">{{ cuña.nombre }}</h4>
                                    <div class="project-meta">
                                        <span class="project-meta-item">
                                            <i class="fas fa-building"></i>
                                            <strong>{{ cuña.cliente.empresa|default:cuña.cliente.get_full_name }}</strong>
                                        </span>
                                        <span class="project-meta-item">
                                            <i class="far fa-clock"></i>
                                            {{ cuña.duracion }} segundos
                                        </span>
                                        <span class="project-meta-item">
                                            <i class="far fa-calendar"></i>
                                            {{ cuña.fecha_inicio|date:"d/m/Y" }} - {{ cuña.fecha_fin|date:"d/m/Y" }}
                                        </span>
                                        {% if cuña.vendedor_asignado %}
                                        <span class="project-meta-item">
                                            <i class="fas fa-user"></i>
                                            {{ cuña.vendedor_asignado.get_full_name }}
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="d-flex align-items-start gap-3">
                                    {% if cuña.estado == 'en_produccion' %}
                                    <span class="status-badge produccion">
                                        <i class="fas fa-spinner fa-spin"></i> En Producción
                                    </span>
                                    {% elif cuña.estado == 'pendiente_revision' %}
                                    <span class="status-badge pendiente">
                                        <i class="fas fa-clock"></i> Pendiente
                                    </span>
                                    {% elif cuña.estado == 'aprobada' %}
                                    <span class="status-badge aprobada">
                                        <i class="fas fa-check"></i> Aprobada
                                    </span>
                                    {% elif cuña.estado == 'activa' %}
                                    <span class="status-badge activa">
                                        <i class="fas fa-broadcast-tower"></i> Al Aire
                                    </span>
                                    {% endif %}
                                    <div class="action-buttons">
                                        <button class="action-btn" title="Ver detalles">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="action-btn" title="Editar">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="action-btn" title="Descargar">
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="fas fa-folder-open"></i>
                            </div>
                            <h3 class="empty-state-title">No hay proyectos asignados</h3>
                            <p class="empty-state-description">
                                Los proyectos aparecerán aquí cuando sean asignados a producción
                            </p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Quick Actions -->
            <div class="main-card mb-4">
                <div class="card-header-pro">
                    <h3 class="card-title-pro">
                        <i class="fas fa-bolt"></i>
                        Acciones Rápidas
                    </h3>
                </div>
                <div class="card-body p-3">
                    <div class="d-grid gap-2">
                        <a href="#" class="quick-action-btn">
                            <div class="quick-action-icon primary">
                                <i class="fas fa-plus"></i>
                            </div>
                            <span class="flex-grow-1 text-start">Nuevo Proyecto</span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                        <a href="#" class="quick-action-btn">
                            <div class="quick-action-icon success">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <span class="flex-grow-1 text-start">Grabar Audio</span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                        <a href="#" class="quick-action-btn">
                            <div class="quick-action-icon info">
                                <i class="fas fa-upload"></i>
                            </div>
                            <span class="flex-grow-1 text-start">Subir Archivo</span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                        <a href="#" class="quick-action-btn">
                            <div class="quick-action-icon secondary">
                                <i class="fas fa-folder"></i>
                            </div>
                            <span class="flex-grow-1 text-start">Biblioteca de Audio</span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Notifications -->
            <div class="main-card mb-4">
                <div class="card-header-pro">
                    <h3 class="card-title-pro">
                        <div class="notification-badge">
                            <i class="fas fa-bell"></i>
                            <span class="notification-count">0</span>
                        </div>
                        Notificaciones
                    </h3>
                </div>
                <div class="card-body-pro">
                    <div class="empty-state py-4">
                        <div class="empty-state-icon" style="width: 60px; height: 60px; font-size: 1.5rem;">
                            <i class="far fa-bell-slash"></i>
                        </div>
                        <p class="empty-state-description mb-0">
                            No hay notificaciones nuevas
                        </p>
                    </div>
                </div>
            </div>

            <!-- Monthly Stats -->
            <div class="main-card">
                <div class="card-header-pro">
                    <h3 class="card-title-pro">
                        <i class="fas fa-chart-bar"></i>
                        Estadísticas del Mes
                    </h3>
                </div>
                <div class="card-body p-3">
                    <div class="progress-container mb-3">
                        <div class="progress-header">
                            <span class="progress-label">Completados</span>
                            <span class="progress-value">{{ cuñas_completadas_hoy }}</span>
                        </div>
                        <div class="progress-bar-custom">
                            <div class="progress-fill success" style="width: 75%;"></div>
                        </div>
                    </div>

                    <div class="progress-container mb-3">
                        <div class="progress-header">
                            <span class="progress-label">En Proceso</span>
                            <span class="progress-value">{{ cuñas_en_produccion }}</span>
                        </div>
                        <div class="progress-bar-custom">
                            <div class="progress-fill primary" style="width: 60%;"></div>
                        </div>
                    </div>

                    <div class="progress-container mb-3">
                        <div class="progress-header">
                            <span class="progress-label">Pendientes</span>
                            <span class="progress-value">{{ cuñas_pendientes }}</span>
                        </div>
                        <div class="progress-bar-custom">
                            <div class="progress-fill warning" style="width: 40%;"></div>
                        </div>
                    </div>

                    <div class="progress-container mb-0">
                        <div class="progress-header">
                            <span class="progress-label">Al Aire</span>
                            <span class="progress-value">{{ cuñas_activas }}</span>
                        </div>
                        <div class="progress-bar-custom">
                            <div class="progress-fill info" style="width: 85%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    console.log('Dashboard de Productor - Versión Profesional cargado');
    
    // ========== RELOJ EN TIEMPO REAL ==========
    function actualizarReloj() {
        const ahora = new Date();
        const horas = String(ahora.getHours()).padStart(2, '0');
        const minutos = String(ahora.getMinutes()).padStart(2, '0');
        const segundos = String(ahora.getSeconds()).padStart(2, '0');
        $('#reloj-tiempo-real').text(`${horas}:${minutos}:${segundos}`);
    }
    
    setInterval(actualizarReloj, 1000);
    actualizarReloj();
    
    // ========== FILTROS DE PROYECTOS ==========
    $('.filter-pill').on('click', function() {
        // Remover clase active de todos
        $('.filter-pill').removeClass('active');
        // Agregar clase active al clickeado
        $(this).addClass('active');
        
        const filtro = $(this).data('filter');
        console.log('Filtro seleccionado:', filtro);
        
        // Aquí puedes implementar la lógica de filtrado
        // Por ejemplo, mostrar/ocultar proyectos según el estado
        if (filtro === 'todos') {
            $('.project-item').show();
        } else if (filtro === 'produccion') {
            $('.project-item').hide();
            $('.project-item:has(.status-badge.produccion)').show();
        } else if (filtro === 'pendientes') {
            $('.project-item').hide();
            $('.project-item:has(.status-badge.pendiente)').show();
        }
    });
    
    // ========== ANIMACIONES DE ENTRADA ==========
    function animateStats() {
        $('.stat-card').each(function(index) {
            $(this).css({
                'opacity': '0',
                'transform': 'translateY(20px)'
            }).delay(index * 100).animate({
                opacity: 1
            }, 400, function() {
                $(this).css('transform', 'translateY(0)');
            });
        });
    }
    
    animateStats();
    
    // ========== TOOLTIPS ==========
    $('[title]').tooltip({
        placement: 'top',
        trigger: 'hover'
    });
    
    // ========== ACCIÓN DE BOTONES ==========
    $('.action-btn').on('click', function(e) {
        e.preventDefault();
        const title = $(this).attr('title');
        console.log('Acción:', title);
        // Aquí puedes agregar la lógica para cada acción
    });
    
    // ========== QUICK ACTIONS ==========
    $('.quick-action-btn').on('click', function(e) {
        e.preventDefault();
        const action = $(this).find('span').text().trim();
        console.log('Quick action:', action);
        // Implementar lógica de acciones rápidas
    });
});
</script>
{% endblock %}